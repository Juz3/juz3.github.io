<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D Tree Growth Simulator</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #1a1a1a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #eee;
        }

        canvas {
            display: block;
        }

        #controls {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 220px;
            padding: 12px;
            background-color: rgba(0, 0, 0, 0.75);
            border-radius: 12px;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            user-select: none;
            overflow-y: auto;
            max-height: calc(100vh - 30px);
        }

        .actionbar {
            display: flex;
            flex-direction: row;
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: auto;
            padding: 10px 15px;
            background-color: rgba(0, 0, 0, 0.75);
            border-radius: 12px;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            user-select: none;
        }

        h1 {
            font-size: 1.0rem;
            margin: 0 0 10px 0;
            text-align: center;
            color: #4ade80;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        h3 {
            font-size: 0.7rem;
            margin: 0 5px 10px 5px;
            padding: 12px 0;
            text-align: center;
            color: #4ade80;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .control-group {
            margin-bottom: 8px;
        }

        label {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            margin-bottom: 4px;
            color: #ccc;
        }

        input[type="range"] {
            width: 100%;
            margin: 0;
            cursor: pointer;
            accent-color: #4ade80;
        }

        .value-display {
            color: #4ade80;
            font-weight: bold;
            font-size: 0.7rem;
        }

        .buttons {
            display: flex;
            gap: 10px;
        }

        button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            font-size: 0.8rem;
        }

        button:active {
            transform: scale(0.95);
        }

        #btn-start {
            background-color: #4a8ade;
            color: #003300;
        }

        #btn-start:hover {
            background-color: #126ee7;
        }

        #btn-grow {
            background-color: #487824;
            color: white;
        }

        #btn-grow:hover {
            background-color: #4b9f0a;
        }

        .stats {
            margin-top: 5px;
            font-size: 0.7rem;
            color: #888;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 5px;
        }

        /* Presets bar */
        #presets {
            position: absolute;
            top: 15px;
            left: 275px; /* beside the controls */
            width: 48px;
            padding: 6px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.06);
        }
        #presets button { width: 36px; height: 36px; padding: 0; font-size: 1.1rem; border-radius: 6px; }
    </style>
</head>
<body>

<canvas id="simCanvas"></canvas>

<div id="controls">
    <h1>Tree Simulator</h1>
    <div class="control-group">
        <label>Growth Speed <span id="val-speed" class="value-display">1</span></label>
        <input type="range" id="speed" min="0.25" max="5" step="0.25" value="1">
    </div>
    <div class="control-group">
        <label>Branch Chance <span id="val-chance" class="value-display">0.035</span></label>
        <input type="range" id="chance" min="0.001" max="0.1" step="0.001" value="0.035">
    </div>
    <div class="control-group">
        <label>Branch Angle (deg) <span id="val-angle" class="value-display">22</span></label>
        <input type="range" id="angle" min="5" max="90" value="22">
    </div>
    <div class="control-group">
        <label>Wiggle / Noise <span id="val-wiggle" class="value-display">0.08</span></label>
        <input type="range" id="wiggle" min="0" max="0.5" step="0.01" value="0.08">
    </div>
    <div class="control-group">
        <label>Phototropism <span id="val-phototropism" class="value-display">0.015</span></label>
        <input type="range" id="phototropism" min="0" max="0.1" step="0.005" value="0.015">
        <div style="font-size:0.7rem; color:#666; text-align:right;">Bias toward "sun"</div>
    </div>
    <div class="control-group">
        <label>Sun Position <span id="val-sun-x" class="value-display">0.50</span></label>
        <input type="range" id="sun-x" min="0" max="1" step="0.01" value="0.5">
    </div>
    <div class="control-group">
        <label>Width <span id="val-initial-width" class="value-display">40</span></label>
        <input type="range" id="initial-width" min="5" max="60" step="1" value="40">
    </div>
    <div class="control-group">
        <label>Thickness Taper <span id="val-taper" class="value-display">0.707</span></label>
        <input type="range" id="taper" min="0.650" max="1" step="0.001" value="0.707">
    </div>
    <div class="control-group">
        <label>Segment Length <span id="val-segment-length" class="value-display">5</span></label>
        <input type="range" id="segment-length" min="2" max="15" step="1" value="5">
    </div>
    <div style="display:flex; gap:6px;">
        <div class="control-group" style="flex:1;">
            <label>Background Color <span id="val-bg-color" class="value-display">#0a0e14</span></label>
            <input type="color" id="bg-color" value="#1a1a1a">
        </div>
        <div class="control-group" style="flex:1;">
            <label>Trunk Color <span id="val-trunk-color" class="value-display">#261910ff</span></label>
            <input type="color" id="trunk-color" value="#372514ff">
        </div>
    </div>
    <div class="control-group">
        <label>Lightness gradient <span id="val-lightness-gradient" class="value-display">on</span></label>
        <div style="display:flex; gap:6px; align-items:center;">
            <input type="checkbox" id="lightness-gradient" checked>
        </div>
        <div style="font-size:0.7rem; color:#666; text-align:right;">Lighter color for thin branches</div>
    </div>
    <div class="control-group">
        <label>Auto-fade thin tips <span id="val-auto-fade" class="value-display">off</span></label>
        <div style="display:flex; gap:6px; align-items:center;">
            <input type="checkbox" id="auto-fade-tips">
        </div>
        <div style="font-size:0.7rem; color:#666; text-align:right;">Natural taper for thin branches</div>
    </div>
    
    <!-- Advanced Controls Toggle -->
    <button id="toggle-advanced" style="width:100%; padding:8px; margin:10px 0; background:#2a2a2a; border:1px solid #444; border-radius:6px; color:#ccc; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:6px;">
        <span>Advanced Controls</span>
        <span id="advanced-arrow" style="transition: transform 0.2s;">‚ñº</span>
    </button>
    
    <!-- Advanced Controls Section (hidden by default) -->
    <div id="advanced-controls" style="display:none;">
        <div class="control-group">
            <label>Max Tip Age <span id="val-max-tip-age" class="value-display">150</span></label>
            <input type="range" id="max-tip-age" min="1" max="1000" step="1" value="150">
        </div>
        <div class="control-group">
            <label>Max Active Tips <span id="val-max-active-tips" class="value-display">175</span></label>
            <input type="range" id="max-active-tips" min="1" max="2000" step="1" value="175">
        </div>
        <div class="control-group">
            <label>Gravity Bias <span id="val-gravity" class="value-display">0.00</span></label>
            <input type="range" id="gravity" min="-0.1" max="0.1" step="0.005" value="0.00">
            <div style="font-size:0.7rem; color:#666; text-align:right;">(Neg=left, Pos=right)</div>
        </div>
        <div class="control-group">
            <label>Old Tip Branch Boost <span id="val-old-tip-branching" class="value-display">0</span></label>
            <input type="range" id="old-tip-branching" min="0" max="10" step="0.5" value="0">
            <div style="font-size:0.7rem; color:#666; text-align:right;">Older tips branch more (0-10x)</div>
        </div>
    </div>
    <div class="control-group">
        <label>Seed <span id="seed-label" class="value-display">‚Äî</span></label>
        <div style="display:flex; gap:6px; align-items:center;">
            <input type="number" id="seed" placeholder="seed (int)" style="flex:1; padding:6px; border-radius:6px; border:1px solid #333; background:#101010; color:#eee;"> 
            <button id="seed-btn" title="Set seed" style="padding:6px">Set</button>
        </div>
    </div>
    <div class="control-group">
        <label>Stop on branch collision <span id="val-stop-collision" class="value-display">off</span></label>
        <div style="display:flex; gap:6px; align-items:center;">
            <input type="checkbox" id="stop-on-collision"> 
        </div>
    </div>
    <div class="control-group">
        <label>Collision grace (new branch steps) <span id="val-collision-grace" class="value-display">2</span></label>
        <input type="range" id="collision-grace" min="0" max="10" step="1" value="3">
    </div>
    <!-- <div class="control-group">
        <label>Leaf Size <span id="val-leaf-size" class="value-display">30</span></label>
        <input type="range" id="leaf-size" min="4" max="64" step="1" value="30">
    </div>
    <div class="control-group">
        <label>Leaf Width <span id="val-leaf-width" class="value-display">15</span></label>
        <input type="range" id="leaf-width" min="2" max="24" step="1" value="15">
    </div>
    <div class="control-group">
        <label>Leaf Color <span id="val-leaf-color" class="value-display">#64c864</span></label>
        <input type="color" id="leaf-color" value="#64c864">
    </div> -->
    <div class="stats">
        <span id="segment-count">0</span> Segments | <span id="tip-count">0</span> Active Tips | <span id="leaf-count">0</span> Leaves
    </div>
</div>
<!-- Presets vertical bar next to controls -->
<div id="presets" aria-label="Presets">
    <h3>Presets</h3>
    <button id="preset-1" title="Dedicuous">üå≥</button>
    <button id="preset-2" title="Roots">ü´ö</button>
    <button id="preset-3" title="Bush">üåø</button>
    <button id="preset-4" title="Grid">üèÅ</button>
</div>
<div class="actionbar">
    <div class="buttons">
        <button id="btn-start" title="Stop">‚èπ</button>
        <button id="btn-grow">Grow New</button>
        <button id="btn-regenerate" title="Regenerate using current seed">Regenerate</button>
        <!-- <button id="btn-create-leaves" style="margin-left:10px;">Addü•¨</button>
        <button id="btn-clear-leaves">Clearü•¨</button> -->
    </div>
</div>
<script src="sim.min.js"></script>
</body>
</html>