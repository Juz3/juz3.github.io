!function(){const t=document.getElementById("simCanvas"),e=t.getContext("2d"),n={speed:.5,branchChance:.02,branchAngle:18,wiggle:.1,gravity:0,taper:.95,initialWidth:12,minWidth:.5,segmentLength:5,seed:null},l={speed:document.getElementById("speed"),chance:document.getElementById("chance"),angle:document.getElementById("angle"),wiggle:document.getElementById("wiggle"),gravity:document.getElementById("gravity"),taper:document.getElementById("taper"),segmentLength:document.getElementById("segment-length"),seedInput:document.getElementById("seed"),seedLabel:document.getElementById("seed-label"),seedBtn:document.getElementById("seed-btn"),regenerateBtn:document.getElementById("btn-regenerate"),btnStart:document.getElementById("btn-start"),btnReset:document.getElementById("btn-reset"),valSpeed:document.getElementById("val-speed"),valChance:document.getElementById("val-chance"),valAngle:document.getElementById("val-angle"),valWiggle:document.getElementById("val-wiggle"),valGravity:document.getElementById("val-gravity"),valTaper:document.getElementById("val-taper"),valSegmentLength:document.getElementById("val-segment-length"),statSegments:document.getElementById("segment-count"),statTips:document.getElementById("tip-count")};let a=[],o=[],i=!0,d=null,s=0,g=null;class r{constructor(t,e,n,l,a){this.x=t,this.y=e,this.angle=n,this.width=l,this.parentIndex=a,this.drawn=!1}}class h{constructor(t,e,n,l,a){this.x=t,this.y=e,this.angle=n,this.width=l,this.parentIndex=a}}let c=Math.random;function u(t){if(null===t||""===t)n.seed=null,c=Math.random,l.seedLabel&&(l.seedLabel.textContent="—");else{const e=Number(t)||0;n.seed=e,c=function(t){let e=t>>>0;return function(){e+=1831565813;let t=Math.imul(e^e>>>15,1|e);return t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}}(e),g=e,l.seedLabel&&(l.seedLabel.textContent=String(e))}}function m(){t.width=window.innerWidth,t.height=window.innerHeight,!i&&a.length>0&&y()}function p(){if(null===n.seed&&null===g){const t=Math.floor(2147483647*Math.random());l.seedInput.value=t,u(t)}else null===n.seed&&null!==g?u(g):null!==n.seed&&u(n.seed);a=[],o=[],s=0;const i=t.width/2,d=t.height;o.push(new h(i,d,-Math.PI/2,n.initialWidth,-1)),e.fillStyle="#1a1a1a",e.fillRect(0,0,t.width,t.height),v()}function y(){e.fillStyle="#1a1a1a",e.fillRect(0,0,t.width,t.height),e.lineCap="round",e.lineJoin="round";for(let t=0;t<a.length;t++){const n=a[t];if(-1===n.parentIndex)continue;const l=a[n.parentIndex],o=n.width,i=Math.max(30,Math.min(70,70-3*o));e.strokeStyle=`hsl(32, 60%, ${i}%)`,e.lineWidth=o,e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(n.x,n.y),e.stroke()}}function v(){l.statSegments.textContent=a.length,l.statTips.textContent=o.length}l.speed.oninput=t=>{n.speed=parseFloat(t.target.value),l.valSpeed.textContent=n.speed},l.chance.oninput=t=>{n.branchChance=parseFloat(t.target.value),l.valChance.textContent=n.branchChance},l.angle.oninput=t=>{n.branchAngle=parseInt(t.target.value),l.valAngle.textContent=n.branchAngle},l.wiggle.oninput=t=>{n.wiggle=parseFloat(t.target.value),l.valWiggle.textContent=n.wiggle},l.gravity.oninput=t=>{n.gravity=parseFloat(t.target.value),l.valGravity.textContent=n.gravity},l.taper.oninput=t=>{n.taper=parseFloat(t.target.value),l.valTaper.textContent=n.taper},l.segmentLength.oninput=t=>{n.segmentLength=parseInt(t.target.value),l.valSegmentLength.textContent=n.segmentLength},l.seedBtn.onclick=()=>{const t=l.seedInput.value;u(""===t?null:Number(t)),p()},l.btnStart.onclick=()=>{i=!i,i?(l.btnStart.textContent="⏹",l.btnStart.title="Stop",l.btnStart.style.backgroundColor="#4ade80",l.btnStart.style.color="#003300"):(l.btnStart.textContent="▶",l.btnStart.title="Play",l.btnStart.style.backgroundColor="#fbbf24",l.btnStart.style.color="#000")},l.btnReset.onclick=()=>{const t=Math.floor(2147483647*Math.random());l.seedInput.value=t,u(t),p(),i||y()},l.regenerateBtn.onclick=()=>{if(null!==n.seed)u(n.seed);else if(null!==g)u(g),l.seedInput.value=g;else{const t=Math.floor(2147483647*Math.random());l.seedInput.value=t,u(t)}p(),i||y()},window.addEventListener("resize",m),m(),u(null),p(),l.btnStart&&(l.btnStart.textContent="⏹",l.btnStart.title="Stop",l.btnStart.style.backgroundColor="#4ade80",l.btnStart.style.color="#003300"),l.btnReset&&(l.btnReset.textContent="Generate new"),function e(){i&&(!function(){if(i){for(s+=n.speed;s>=1&&(s-=1,0!==o.length);){let e=[];for(let l=0;l<o.length;l++){const i=o[l];if(i.width<n.minWidth||i.x<-50||i.x>t.width+50||i.y<-50||i.y>t.height+50)continue;const d=(c()-.5)*n.wiggle,s=c(),g=n.gravity;let u=i.angle+d+g;const m=i.x+Math.cos(u)*n.segmentLength,p=i.y+Math.sin(u)*n.segmentLength,y=a.length;if(a.push(new r(m,p,u,i.width,i.parentIndex)),s<n.branchChance){const t=n.branchAngle*Math.PI/180;e.push(new h(m,p,u-t,i.width*n.taper,y)),e.push(new h(m,p,u+t,i.width*n.taper,y))}else{const t=.999;e.push(new h(m,p,u,i.width*t,y))}}o=e}v()}}(),y()),d=requestAnimationFrame(e)}()}();