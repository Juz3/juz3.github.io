!function(){const t=document.getElementById("simCanvas"),e=t.getContext("2d"),n={speed:.5,branchChance:.02,branchAngle:18,wiggle:.1,gravity:0,taper:.95,initialWidth:12,minWidth:.5,segmentLength:5,seed:null},a={speed:document.getElementById("speed"),chance:document.getElementById("chance"),angle:document.getElementById("angle"),wiggle:document.getElementById("wiggle"),gravity:document.getElementById("gravity"),taper:document.getElementById("taper"),segmentLength:document.getElementById("segment-length"),seedInput:document.getElementById("seed"),seedLabel:document.getElementById("seed-label"),seedBtn:document.getElementById("seed-btn"),randomSeedBtn:document.getElementById("randomize-seed-btn"),btnStart:document.getElementById("btn-start"),btnReset:document.getElementById("btn-reset"),valSpeed:document.getElementById("val-speed"),valChance:document.getElementById("val-chance"),valAngle:document.getElementById("val-angle"),valWiggle:document.getElementById("val-wiggle"),valGravity:document.getElementById("val-gravity"),valTaper:document.getElementById("val-taper"),valSegmentLength:document.getElementById("val-segment-length"),statSegments:document.getElementById("segment-count"),statTips:document.getElementById("tip-count")};let l=[],o=[],i=!0,d=null,g=0,s=!1;class r{constructor(t,e,n,a,l){this.x=t,this.y=e,this.angle=n,this.width=a,this.parentIndex=l,this.drawn=!1}}class h{constructor(t,e,n,a,l){this.x=t,this.y=e,this.angle=n,this.width=a,this.parentIndex=l}}let c=Math.random;function u(t){if(null===t||""===t)n.seed=null,c=Math.random,a.seedLabel&&(a.seedLabel.textContent="—");else{const e=Number(t)||0;n.seed=e,c=function(t){let e=t>>>0;return function(){e+=1831565813;let t=Math.imul(e^e>>>15,1|e);return t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}}(e),a.seedLabel&&(a.seedLabel.textContent=String(e))}}function m(){t.width=window.innerWidth,t.height=window.innerHeight,!i&&l.length>0&&y()}function p(){l=[],o=[],g=0;const a=t.width/2,i=t.height;o.push(new h(a,i,-Math.PI/2,n.initialWidth,-1)),e.fillStyle="#1a1a1a",e.fillRect(0,0,t.width,t.height),b()}function y(){e.fillStyle="#1a1a1a",e.fillRect(0,0,t.width,t.height),e.lineCap="round",e.lineJoin="round";for(let t=0;t<l.length;t++){const n=l[t];if(-1===n.parentIndex)continue;const a=l[n.parentIndex],o=n.width,i=Math.max(30,Math.min(70,70-3*o));e.strokeStyle=`hsl(32, 60%, ${i}%)`,e.lineWidth=o,e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(n.x,n.y),e.stroke()}}function b(){a.statSegments.textContent=l.length,a.statTips.textContent=o.length}a.speed.oninput=t=>{n.speed=parseFloat(t.target.value),a.valSpeed.textContent=n.speed},a.chance.oninput=t=>{n.branchChance=parseFloat(t.target.value),a.valChance.textContent=n.branchChance},a.angle.oninput=t=>{n.branchAngle=parseInt(t.target.value),a.valAngle.textContent=n.branchAngle},a.wiggle.oninput=t=>{n.wiggle=parseFloat(t.target.value),a.valWiggle.textContent=n.wiggle},a.gravity.oninput=t=>{n.gravity=parseFloat(t.target.value),a.valGravity.textContent=n.gravity},a.taper.oninput=t=>{n.taper=parseFloat(t.target.value),a.valTaper.textContent=n.taper},a.segmentLength.oninput=t=>{n.segmentLength=parseInt(t.target.value),a.valSegmentLength.textContent=n.segmentLength},a.seedBtn.onclick=()=>{const t=a.seedInput.value;u(""===t?null:Number(t)),p()},a.randomSeedBtn.onclick=()=>{const t=Math.floor(2147483647*Math.random());a.seedInput.value=t,u(t),p(),s||(s=!0,a.btnReset.textContent="Reset")},a.btnStart.onclick=()=>{i=!i,i?(a.btnStart.textContent="⏹",a.btnStart.title="Stop",a.btnStart.style.backgroundColor="#4ade80",a.btnStart.style.color="#003300"):(a.btnStart.textContent="▶",a.btnStart.title="Play",a.btnStart.style.backgroundColor="#fbbf24",a.btnStart.style.color="#000")},a.btnReset.onclick=()=>{const t=Math.floor(2147483647*Math.random());a.seedInput.value=t,u(t),p(),s||(s=!0,a.btnReset.textContent="Reset"),i||y()},window.addEventListener("resize",m),m(),u(null),p(),a.btnStart&&(a.btnStart.textContent="⏹",a.btnStart.title="Stop",a.btnStart.style.backgroundColor="#4ade80",a.btnStart.style.color="#003300"),a.btnReset&&(a.btnReset.textContent="Generate"),function e(){i&&(!function(){if(i){for(g+=n.speed;g>=1&&(g-=1,0!==o.length);){let e=[];for(let a=0;a<o.length;a++){const i=o[a];if(i.width<n.minWidth||i.x<-50||i.x>t.width+50||i.y<-50||i.y>t.height+50)continue;const d=(c()-.5)*n.wiggle,g=c(),s=n.gravity;let u=i.angle+d+s;const m=i.x+Math.cos(u)*n.segmentLength,p=i.y+Math.sin(u)*n.segmentLength,y=l.length;if(l.push(new r(m,p,u,i.width,i.parentIndex)),g<n.branchChance){const t=n.branchAngle*Math.PI/180;e.push(new h(m,p,u-t,i.width*n.taper,y)),e.push(new h(m,p,u+t,i.width*n.taper,y))}else{const t=.999;e.push(new h(m,p,u,i.width*t,y))}}o=e}b()}}(),y()),d=requestAnimationFrame(e)}()}();